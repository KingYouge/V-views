<template>
  <div class="main__lazyLoad">
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
    <img src="" class="image-item" lazyload="true" data-original="./../../../static/imgs/card__img.jpg" />
  </div>
</template>
<script>
export default {
  name: 'LazyLoad',
  data() {
    return {
      viewHeight: '',
    }
  },
  mounted() {
    // 获取可视区高度
    this.viewHeight = document.documentElement.clientHeight; 
    // 刚开始还没滚动屏幕时，要先触发一次函数，初始化首页的页面图片
    this.lazyload()
    // 监听滚动事件
    let $views = document.querySelector('.views__content');
    $views.addEventListener( "scroll", this.lazyload)
  },
  methods: {
    lazyload() {
      const self = this;
      var eles = document.querySelectorAll( 'img[data-original][lazyload]')
      Array.prototype.forEach.call(eles, function (item, index) {
        var rect;
        if (item.dataset.original === "") return;
        // 用于获得页面中某个元素的左，上，右和下分别相对浏览器视窗的位置
        rect = item.getBoundingClientRect()
        if (rect.bottom >= 0 && rect.top < self.viewHeight) {
          ! function () {
              var img = new Image()
              img.src = item.dataset.original;
              img.onload = function () {
                  item.src = img.src
              }
              // 移除属性，下次不再遍历
              item.removeAttribute( "data-original")
              item.removeAttribute( "lazyload")
          }()
        }
      })
    }
  }
}
</script>
<style>
.main__lazyLoad img {
  float: left;
  width: 24.25%;
  height: 200px;
  margin-right: 1%;
  margin-bottom: 20px;
}
.main__lazyLoad img:nth-child(4n) {
  margin-right: 0;
}
</style>
